<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Schedule</title>
	<style>

.week-input-container {
  display: flex;

  margin-top: 10px;
}

#btn1, #btn2, #btn3 {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 10px;
  cursor: pointer;
  border-radius: 5px;
}
#fileInput{

	background-color: #4CAF50;
  border: none;
  color: white;
  padding: 5px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 10px;
  margin: 13px;
  cursor: pointer;
  border-radius: 5px;

}


#btaux{
	background-color: #4CAF50;
  border: none;
  color: white;
  padding: 5px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 10px;
  margin: 10px;
  cursor: pointer;
  border-radius: 5px;

}
				body {
			font-family: Arial, sans-serif;
			background-color: #f7f7f7;
		}

		h1 {
			text-align: center;
			margin-top: 50px;
			margin-bottom: 30px;
		}

		#tableSemanal {
			border-collapse: collapse;
			width: 80%;
			margin: 0 auto;
			background-color: #fff;
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
			
		}
		#div1, #div2, #div3 {
 		 display: none;
		}

		th, td {
			padding: 12px 15px;
			border-bottom: 1px solid #ddd;
			text-align:left;
		}

		tr:hover {
			background-color: #f5f5f5;
		}

		th {
			background-color: #4CAF50;
			color: white;
		}

		h2 {
			margin-top: 50px;
			margin-bottom: 20px;
		}

		legend {
			font-weight: bold;
			margin-bottom: 10px;
		}

		ul {
			margin-left: 30px;
			padding: 0;
		}

		li {
			margin-bottom: 5px;
		}
	</style>
</head>
<body>
	<input type="file" id="fileInput"  accept=".csv">
	<br><br>
	
	<button id="btn1" onclick="showDiv('div1')">Daily View</button>
	<button id="btn2" onclick="showDiv('div2')">Weekly View</button>
	<button id="btn3" onclick="showDiv('div3')">Monthly View</button>
	
	<div id="div1">
		<form>
			<br>
			<label for="date">Choose a date:</label>
			<input type="date" id="date" name="date">
			<button id ="btaux" type="button" onclick="showSchedule()">Show Schedule</button>
			<br>
		  </form>
		<table summary="daily schedule" id="tableSemanal">
			
			<thead>
				<tr>
					<th>Time</th>
					<th>Day</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>08:00 - 08:30</td>
					<td id="time0800-dia"></td>
				</tr>
				<tr>
					<td>08:30 - 09:00</td>
					<td id="time0830-dia"></td>
				</tr>
				<tr>
					<td>09:00 - 9:30</td>
					<td id="time0900-dia"></td>

				</tr>
				<tr>
					<td>09:30 - 10:00</td>
					<td id="time0930-dia"></td>

				</tr>
				<tr>
					<td>10:00 - 10:30</td>
					<td id="time1000-dia"></td>

				</tr>
				<tr>
					<td>10:30 - 11:00</td>
					<td id="time1030-dia"></td>

				</tr>
				<tr>
					<td>11:00 - 11:30</td>
					<td id="time1100-dia"></td>
	
				</tr>
				<tr>
					<td>11:30 - 12:00</td>
					<td id="time1130-dia"></td>
	
				</tr>
				<tr>
					<td>12:00 - 12:30</td>
					<td id="time1200-dia"></td>

				</tr>
				<tr>
					<td>12:30 - 13:00</td>
					<td id="time1230-dia"></td>
		
				</tr>
				<tr>
					<td>13:00 - 13:30</td>
					<td id="time1300-dia"></td>

				</tr>
				<tr>
					<td>13:30 - 14:00</td>
					<td id="time1330-dia"></td>

				</tr>
				<tr>
					<td>14:00 - 14:30</td>
					<td id="time1400-dia"></td>

				</tr>
				<tr>
					<td>14:30 - 15:00</td>
					<td id="time1430-dia"></td>

				</tr>
				<tr>
					<td>15:00 - 15:30</td>
					<td id="time1500-dia"></td>

				</tr>
				<tr>
					<td>15:30 - 16:00</td>
					<td id="time1530-dia"></td>

				</tr>
				<tr>
					<td>16:00 - 16:30</td>
					<td id="time1600-dia"></td>
	
				</tr>
				<tr>
					<td>16:30 - 17:00</td>
					<td id="time1630-dia"></td>

				</tr>
				<tr>
					<td>17:00 - 17:30</td>
					<td id="time1700-dia"></td>

				</tr>
				<tr>
					<td>17:30 - 18:00</td>
					<td id="time1730-dia"></td>
	
				</tr>
				<tr>
					<td>18:00 - 18:30</td>
					<td id="time1800-dia"></td>

				</tr>
				<tr>
					<td>18:30 - 19:00</td>
					<td id="time1830-dia"></td>
	
				</tr>
				<tr>
					<td>19:00 - 19:30</td>
					<td id="time1900-dia"></td>

				</tr>
				<tr>
					<td>19:30 - 20:00</td>
					<td id="time1930-dia"></td>

				</tr>
				<tr>
					<td>20:00 - 20:30</td>
					<td id="time2000-dia"></td>

				</tr>
				<tr>
					<td>20:30 - 21:00</td>
					<td id="time2030-dia"></td>

				</tr>
				<tr>
					<td>21:00 - 21:30</td>
					<td id="time2100-dia"></td>

				</tr>
				<tr>
					<td>21:30 - 22:00</td>
					<td id="time2130-dia"></td>

				</tr>
			</tbody>
		</table>
		</div>
	
	<div id="div3">
		

		<label for="month">Month:</label>
		<select id="month">
			<option value="01">January</option>
			<option value="02">February</option>
			<option value="03">March</option>
			<option value="04">April</option>
			<option value="05">May</option>
			<option value="06">June</option>
			<option value="07">July</option>
			<option value="08">August</option>
			<option value="09">September</option>
			<option value="10">October</option>
			<option value="11">November</option>
			<option value="12">December</option>
		</select>
	
		<label for="year">Year:</label>
		<input type="number" id="year" value="2022">
	
		<button id="btaux" onclick="generateTable()">Generate Table</button>
	
		<div id="table-container"></div>


	</div>	

	<div id="div2">
		<br>
		<div class="week-input-container">
		  <input type="number" id="weekInput" min="1" max="52" value="1" oninput="displayWeekDates()">
		  <div id="weekDates"></div>
		  <button id="btaux" onclick="readFile()">Show Schedule</button>
		</div>
		<br>
	<table summary="weekly schedule" id="tableSemanal">
        
        
		<thead>
			<tr>
				<th>Time</th>
				<th>Monday</th>
				<th>Tuesday</th>
				<th>Wednesday</th>
				<th>Thursday</th>
				<th>Friday</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>08:00 - 08:30</td>
				<td id="time0800-seg"></td>
				<td id="time0800-ter"></td>
				<td id="time0800-qua"></td>
				<td id="time0800-qui"></td>
				<td id="time0800-sex"></td>
			</tr>
            <tr>
				<td>08:30 - 09:00</td>
				<td id="time0830-seg"></td>
				<td id="time0830-ter"></td>
				<td id="time0830-qua"></td>
				<td id="time0830-qui"></td>
				<td id="time0830-sex"></td>
			</tr>
			<tr>
				<td>09:00 - 9:30</td>
				<td id="time0900-seg"></td>
				<td id="time0900-ter"></td>
				<td id="time0900-qua"></td>
				<td id="time0900-qui"></td>
				<td id="time0900-sex"></td>
			</tr>
            <tr>
				<td>09:30 - 10:00</td>
				<td id="time0930-seg"></td>
				<td id="time0930-ter"></td>
				<td id="time0930-qua"></td>
				<td id="time0930-qui"></td>
				<td id="time0930-sex"></td>
			</tr>
			<tr>
				<td>10:00 - 10:30</td>
				<td id="time1000-seg"></td>
				<td id="time1000-ter"></td>
				<td id="time1000-qua"></td>
				<td id="time1000-qui"></td>
				<td id="time1000-sex"></td>
			</tr>
            <tr>
				<td>10:30 - 11:00</td>
				<td id="time1030-seg"></td>
				<td id="time1030-ter"></td>
				<td id="time1030-qua"></td>
				<td id="time1030-qui"></td>
				<td id="time1030-sex"></td>
			</tr>
			<tr>
				<td>11:00 - 11:30</td>
				<td id="time1100-seg"></td>
				<td id="time1100-ter"></td>
				<td id="time1100-qua"></td>
				<td id="time1100-qui"></td>
				<td id="time1100-sex"></td>
			</tr>
            <tr>
				<td>11:30 - 12:00</td>
				<td id="time1130-seg"></td>
				<td id="time1130-ter"></td>
				<td id="time1130-qua"></td>
				<td id="time1130-qui"></td>
				<td id="time1130-sex"></td>
			</tr>
			<tr>
				<td>12:00 - 12:30</td>
				<td id="time1200-seg"></td>
				<td id="time1200-ter"></td>
				<td id="time1200-qua"></td>
				<td id="time1200-qui"></td>
				<td id="time1200-sex"></td>
			</tr>
            <tr>
				<td>12:30 - 13:00</td>
				<td id="time1230-seg"></td>
				<td id="time1230-ter"></td>
				<td id="time1230-qua"></td>
				<td id="time1230-qui"></td>
				<td id="time1230-sex"></td>
			</tr>
            <tr>
                <td>13:00 - 13:30</td>
                <td id="time1300-seg"></td>
                <td id="time1300-ter"></td>
				<td id="time1300-qua"></td>
				<td id="time1300-qui"></td>
				<td id="time1300-sex"></td>
			</tr>
            <tr>
                <td>13:30 - 14:00</td>
                <td id="time1330-seg"></td>
                <td id="time1330-ter"></td>
				<td id="time1330-qua"></td>
				<td id="time1330-qui"></td>
				<td id="time1330-sex"></td>
			</tr>
            <tr>
                <td>14:00 - 14:30</td>
                <td id="time1400-seg"></td>
                <td id="time1400-ter"></td>
				<td id="time1400-qua"></td>
				<td id="time1400-qui"></td>
				<td id="time1400-sex"></td>
			</tr>
            <tr>
                <td>14:30 - 15:00</td>
                <td id="time1430-seg"></td>
                <td id="time1430-ter"></td>
				<td id="time1430-qua"></td>
				<td id="time1430-qui"></td>
				<td id="time1430-sex"></td>
			</tr>
            <tr>
                <td>15:00 - 15:30</td>
                <td id="time1500-seg"></td>
                <td id="time1500-ter"></td>
				<td id="time1500-qua"></td>
				<td id="time1500-qui"></td>
				<td id="time1500-sex"></td>
			</tr>
            <tr>
                <td>15:30 - 16:00</td>
                <td id="time1530-seg"></td>
                <td id="time1530-ter"></td>
				<td id="time1530-qua"></td>
				<td id="time1530-qui"></td>
				<td id="time1530-sex"></td>
			</tr>
			<tr>
                <td>16:00 - 16:30</td>
                <td id="time1600-seg"></td>
                <td id="time1600-ter"></td>
				<td id="time1600-qua"></td>
				<td id="time1600-qui"></td>
				<td id="time1600-sex"></td>
			</tr>
            <tr>
                <td>16:30 - 17:00</td>
                <td id="time1630-seg"></td>
                <td id="time1630-ter"></td>
				<td id="time1630-qua"></td>
				<td id="time1630-qui"></td>
				<td id="time1630-sex"></td>
			</tr>
			<tr>
				<td>17:00 - 17:30</td>
				<td id="time1700-seg"></td>
				<td id="time1700-ter"></td>
				<td id="time1700-qua"></td>
				<td id="time1700-qui"></td>
				<td id="time1700-sex"></td>
			</tr>
            <tr>
				<td>17:30 - 18:00</td>
				<td id="time1730-seg"></td>
				<td id="time1730-ter"></td>
				<td id="time1730-qua"></td>
				<td id="time1730-qui"></td>
				<td id="time1730-sex"></td>
			</tr>
            <tr>
				<td>18:00 - 18:30</td>
				<td id="time1800-seg"></td>
				<td id="time1800-ter"></td>
				<td id="time1800-qua"></td>
				<td id="time1800-qui"></td>
				<td id="time1800-sex"></td>
			</tr>
            <tr>
				<td>18:30 - 19:00</td>
				<td id="time1830-seg"></td>
				<td id="time1830-ter"></td>
				<td id="time1830-qua"></td>
				<td id="time1830-qui"></td>
				<td id="time1830-sex"></td>
			</tr>
            <tr>
				<td>19:00 - 19:30</td>
				<td id="time1900-seg"></td>
				<td id="time1900-ter"></td>
				<td id="time1900-qua"></td>
				<td id="time1900-qui"></td>
				<td id="time1900-sex"></td>
			</tr>
            <tr>
				<td>19:30 - 20:00</td>
				<td id="time1930-seg"></td>
				<td id="time1930-ter"></td>
				<td id="time1930-qua"></td>
				<td id="time1930-qui"></td>
				<td id="time1930-sex"></td>
			</tr>
            <tr>
				<td>20:00 - 20:30</td>
				<td id="time2000-seg"></td>
				<td id="time2000-ter"></td>
				<td id="time2000-qua"></td>
				<td id="time2000-qui"></td>
				<td id="time2000-sex"></td>
			</tr>
            <tr>
				<td>20:30 - 21:00</td>
				<td id="time2030-seg"></td>
				<td id="time2030-ter"></td>
				<td id="time2030-qua"></td>
				<td id="time2030-qui"></td>
				<td id="time2030-sex"></td>
			</tr>
            <tr>
				<td>21:00 - 21:30</td>
				<td id="time2100-seg"></td>
				<td id="time2100-ter"></td>
				<td id="time2100-qua"></td>
				<td id="time2100-qui"></td>
				<td id="time2100-sex"></td>
			</tr>
            <tr>
				<td>21:30 - 22:00</td>
				<td id="time2130-seg"></td>
				<td id="time2130-ter"></td>
				<td id="time2130-qua"></td>
				<td id="time2130-qui"></td>
				<td id="time2130-sex"></td>
			</tr>
		</tbody>
	</table>
	</div>
	<script>

function generateTable() {
			// Get month and year selected by the user
			const month = document.getElementById("month").value;
			const year = document.getElementById("year").value;

			// Get number of days in the month
			const daysInMonth = new Date(year, month, 0).getDate();

			// Get the weekday of the first day of the month
			const firstDay = new Date(year, month - 1, 1).getDay();

			// Create the table element
			const table = document.createElement("table");

			// Create the table header row
			const headerRow = document.createElement("tr");
			const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
			for (let i = 0; i < 7; i++) {
				const th = document.createElement("th");
				const text = document.createTextNode(daysOfWeek[i]);
				th.appendChild(text);
				headerRow.appendChild(th);
			}
			table.appendChild(headerRow);

			// Create the table rows for each day
			let date = 1;
			for (let i = 0; i < 6; i++) {
				const row = document.createElement("tr");
				for (let j = 0; j < 7; j++) {
					const cell = document.createElement("td");
					if (i === 0 && j < firstDay) {
						// Create empty cells for days before the 1st of the month
					} else if (date > daysInMonth) {
						// Create empty cells for days after the end of the month
					} else {
						// Create a cell for the current day
						const id = year + "-" + month + "-" + date.toString().padStart(2, '0');
						console.log("id: "+id);
						cell.setAttribute("id", id);
						const text = document.createTextNode(date);
						cell.appendChild(text);
						date++;
					}
					row.appendChild(cell);
				}
				table.appendChild(row);
			}

			// Add the table to the page
			const container = document.getElementById("table-container");
			container.innerHTML = "";
			container.appendChild(table);

			
			const fileInput = document.getElementById('fileInput');
			const file = fileInput.files[0];
			const reader = new FileReader();
			reader.onload = () => {
				const contents = reader.result;
				const data = contents.trim().split('\n').map(row => row.split(';'));

				for (let row of data) {

					const datas = row[8];
					var d1 = datas.split('/').reverse().join('-');	
					var mes = d1.split('-')[1];
					
					var ano = d1.split('-')[0];
					

					console.log("mes - "+mes);
					console.log("month - "+month);
					console.log("ano - "+ano);
					console.log("year - "+year);
					console.log((mes != month || ano != year ));
					if (mes != month || ano != year ) {
                    continue; // skip classes not in the selected week
                	}

						const td = document.getElementById(d1);

						td.textContent += ` - ${row[1]}`;
				}
			};

			reader.readAsText(file);
		}

		




function displayWeekDates() {
  const weekInput = document.getElementById("weekInput");
  const selectedWeek = parseInt(weekInput.value);
  const yearStart = new Date(new Date().getFullYear(), 0, 1); // first day of current year
  const startDate = new Date(yearStart.getTime() + ((selectedWeek - 1) * 7 * 24 * 60 * 60 * 1000)); // start date of selected week
  const endDate = new Date(startDate.getTime() + (6 * 24 * 60 * 60 * 1000)); // end date of selected week
  const startDay = startDate.getDate();
  const startMonth = startDate.toLocaleString('default', { month: 'long' });
  const endDay = endDate.getDate();
  const endMonth = endDate.toLocaleString('default', { month: 'long' });
  const weekDates = document.getElementById("weekDates");
  weekDates.textContent = `Week ${selectedWeek} (${startDay} ${startMonth} - ${endDay} ${endMonth})`;
}
displayWeekDates(); // display dates for default value








function showDiv(divId) {
  // Hide all divs
  document.getElementById('div1').style.display = 'none';
  document.getElementById('div2').style.display = 'none';
  document.getElementById('div3').style.display = 'none';

  // Show the selected div
  document.getElementById(divId).style.display = 'block';
}
		const div = document.getElementById('tableSemanal');

		function getWeekNumber(date) {
		  // Copy date so don't modify original
		  const dateParts = date.split("/");

			const day = dateParts[0];
			const month = dateParts[1];
			const year = dateParts[2];	

 		 const d = new Date(Date.UTC(year, month, day));
		  // Set to nearest Thursday: current date + 4 - current day number
		  // Make Sunday's day number 7
		  d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
		  // Get first day of year
		  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 4));
	 	 // Calculate full weeks to nearest Thursday
	  	const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
	  	// Return week number and year
		  console.log("numero da semana_ "+weekNo);
		  return [weekNo];
		}
		function clearSchedule() {
   		   const cells = document.querySelectorAll('[id^="time"]');
     		 for (let cell of cells) {
       		 cell.textContent = '';
    		  }
   		 }

		function showSchedule(){
			clearSchedule();
			const date = document.getElementById('date').value;
			console.log(date);

			const fileInput = document.getElementById('fileInput');
			const file = fileInput.files[0];
			const reader = new FileReader();
			reader.onload = () => {
				const contents = reader.result;
				const data = contents.trim().split('\n').map(row => row.split(';'));

				for (let row of data) {
					const startTime = row[6];
					const endTime = row[7];
					const data = row[8];
					var d1 = data.split('/').reverse().join('-');
					const room = row[9];
					console.log(date);
					console.log(d1);
					if (date != d1) {
                    continue; // skip classes not in the selected week
                	}


					const startHour = parseInt(startTime.split(':')[0]);
					const startMinute = parseInt(startTime.split(':')[1]);
					const endHour = parseInt(endTime.split(':')[0]);
					const endMinute = parseInt(endTime.split(':')[1]);

					const startSlot = (startHour * 60 + startMinute - 480) / 60;
					const endSlot = (endHour * 60 + endMinute - 480) / 60;

					for (let slot = startSlot; slot < endSlot; slot+=0.5) {
                        let realHour ;
                        let realMinute;
						let lastString;
                        if(Number.isInteger(slot)){
                            realHour=slot+8;
                            realMinute=00;
                        }else{
                            realHour=slot-0.5+8;
                            realMinute=30; 
                        }
                        
                        var teste= "time" + (realHour).toString().padStart(2, '0')+realMinute.toString().padStart(2, '0')+"-"+"dia" ;

                       console.log(document.getElementById(teste));
						const td = document.getElementById(teste);
						console.log("depois disto");

						if(lastString === `${row[0]}\n${row[1]}\n${row[2]}\n${room}` ){
						td.textContent = `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						}else{
						td.textContent += `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						lastString = `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						}
                    }
					
				}
			};

			reader.readAsText(file);
		}

		function readFile() {
			
			clearSchedule();
			const fileInput = document.getElementById('fileInput');
			const file = fileInput.files[0];
			const reader = new FileReader();
			reader.onload = () => {
				const contents = reader.result;
				const data = contents.trim().split('\n').map(row => row.split(';'));

				for (let row of data) {
					const day = row[5];
					const startTime = row[6];
					const endTime = row[7];
					const date = row[8];
					const week = getWeekNumber(date);
					const room = row[9];
					const selectedWeek = parseInt(document.getElementById('weekInput').value);

					if (week != selectedWeek) {
                    continue; // skip classes not in the selected week
                	}


					const startHour = parseInt(startTime.split(':')[0]);
					const startMinute = parseInt(startTime.split(':')[1]);
					const endHour = parseInt(endTime.split(':')[0]);
					const endMinute = parseInt(endTime.split(':')[1]);

					const startSlot = (startHour * 60 + startMinute - 480) / 60;
					const endSlot = (endHour * 60 + endMinute - 480) / 60;

                    
					for (let slot = startSlot; slot < endSlot; slot+=0.5) {
                        let realHour ;
                        let realMinute;
						let lastString;
  
                        if(Number.isInteger(slot)){
                            realHour=slot+8;
                            realMinute=00;
                        }else{
                            realHour=slot-0.5+8;
                            realMinute=30; 
                        }
                        
                        var teste= "time" + (realHour).toString().padStart(2, '0')+realMinute.toString().padStart(2, '0')+"-"+day.toLowerCase() ;

						const td = document.getElementById(teste);
						

						if(lastString === `${row[0]}\n${row[1]}\n${row[2]}\n${room}` ){
						td.textContent = `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						}else{
						td.textContent += `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						lastString = `${row[0]}\n${row[1]}\n${row[2]}\n${room}`;
						}
		
                    }
					
				}
			};

			reader.readAsText(file);
		}
	</script>
	
</body>
</html>
